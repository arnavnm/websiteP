{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nimport Observable from 'zen-observable-ts';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport { MqttOverWSProvider } from './MqttOverWSProvider';\nvar logger = new Logger('AWSAppSyncProvider');\n/**\n * @deprecated Unused, all usecases have migrated to AWSAppSyncRealtimeProvider\n */\n\nvar AWSAppSyncProvider =\n/** @class */\nfunction (_super) {\n  __extends(AWSAppSyncProvider, _super);\n\n  function AWSAppSyncProvider() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this._topicClient = new Map();\n    _this._topicAlias = new Map();\n    return _this;\n  }\n\n  Object.defineProperty(AWSAppSyncProvider.prototype, \"endpoint\", {\n    get: function () {\n      throw new Error('Not supported');\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AWSAppSyncProvider.prototype.getProviderName = function () {\n    return 'AWSAppSyncProvider';\n  };\n\n  AWSAppSyncProvider.prototype.publish = function (topics, msg, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        throw new Error('Operation not supported');\n      });\n    });\n  };\n\n  AWSAppSyncProvider.prototype._cleanUp = function (clientId) {\n    var _this = this;\n\n    var topicsForClient = Array.from(this._topicClient.entries()).filter(function (_a) {\n      var _b = __read(_a, 2),\n          c = _b[1];\n\n      return c.clientId === clientId;\n    }).map(function (_a) {\n      var _b = __read(_a, 1),\n          t = _b[0];\n\n      return t;\n    });\n    topicsForClient.forEach(function (t) {\n      return _this._cleanUpForTopic(t);\n    });\n  };\n\n  AWSAppSyncProvider.prototype._cleanUpForTopic = function (topic) {\n    this._topicClient.delete(topic);\n\n    this._topicAlias.delete(topic);\n  };\n\n  AWSAppSyncProvider.prototype.onDisconnect = function (_a) {\n    var _this = this;\n\n    var clientId = _a.clientId,\n        errorCode = _a.errorCode,\n        args = __rest(_a, [\"clientId\", \"errorCode\"]);\n\n    if (errorCode !== 0) {\n      var topicsForClient = Array.from(this._topicClient.entries()).filter(function (_a) {\n        var _b = __read(_a, 2),\n            c = _b[1];\n\n        return c.clientId === clientId;\n      }).map(function (_a) {\n        var _b = __read(_a, 1),\n            t = _b[0];\n\n        return t;\n      });\n      topicsForClient.forEach(function (topic) {\n        if (_this._topicObservers.has(topic)) {\n          _this._topicObservers.get(topic).forEach(function (obs) {\n            if (!obs.closed) {\n              obs.error(args);\n            }\n          });\n\n          _this._topicObservers.delete(topic);\n        }\n      });\n\n      this._cleanUp(clientId);\n    }\n  };\n\n  AWSAppSyncProvider.prototype.disconnect = function (clientId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var client;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.clientsQueue.get(clientId, function () {\n              return null;\n            })];\n\n          case 1:\n            client = _a.sent();\n            return [4\n            /*yield*/\n            , _super.prototype.disconnect.call(this, clientId)];\n\n          case 2:\n            _a.sent();\n\n            this._cleanUp(clientId);\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AWSAppSyncProvider.prototype.subscribe = function (topics, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var result = new Observable(function (observer) {\n      var targetTopics = [].concat(topics);\n      logger.debug('Subscribing to topic(s)', targetTopics.join(','));\n\n      (function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var _a, mqttConnections, newSubscriptions, newAliases, map;\n\n          var _this = this;\n\n          return __generator(this, function (_b) {\n            switch (_b.label) {\n              case 0:\n                // Add these topics to map\n                targetTopics.forEach(function (t) {\n                  if (!_this._topicObservers.has(t)) {\n                    _this._topicObservers.set(t, new Set());\n                  }\n\n                  _this._topicObservers.get(t).add(observer);\n                });\n                _a = options.mqttConnections, mqttConnections = _a === void 0 ? [] : _a, newSubscriptions = options.newSubscriptions;\n                newAliases = Object.entries(newSubscriptions).map(function (_a) {\n                  var _b = __read(_a, 2),\n                      alias = _b[0],\n                      v = _b[1];\n\n                  return [v.topic, alias];\n                }); // Merge new aliases with old ones\n\n                this._topicAlias = new Map(__spread(Array.from(this._topicAlias.entries()), newAliases));\n                map = Object.entries(targetTopics.reduce(function (acc, elem) {\n                  var connectionInfoForTopic = mqttConnections.find(function (c) {\n                    return c.topics.indexOf(elem) > -1;\n                  });\n\n                  if (connectionInfoForTopic) {\n                    var clientId = connectionInfoForTopic.client,\n                        url = connectionInfoForTopic.url;\n\n                    if (!acc[clientId]) {\n                      acc[clientId] = {\n                        url: url,\n                        topics: new Set()\n                      };\n                    }\n\n                    acc[clientId].topics.add(elem);\n                  }\n\n                  return acc;\n                }, {})); // reconnect everything we have in the map\n\n                return [4\n                /*yield*/\n                , Promise.all(map.map(function (_a) {\n                  var _b = __read(_a, 2),\n                      clientId = _b[0],\n                      _c = _b[1],\n                      url = _c.url,\n                      topics = _c.topics;\n\n                  return __awaiter(_this, void 0, void 0, function () {\n                    var client, err_1;\n\n                    var _this = this;\n\n                    return __generator(this, function (_d) {\n                      switch (_d.label) {\n                        case 0:\n                          client = null;\n                          _d.label = 1;\n\n                        case 1:\n                          _d.trys.push([1, 3,, 4]);\n\n                          return [4\n                          /*yield*/\n                          , this.connect(clientId, {\n                            clientId: clientId,\n                            url: url\n                          })];\n\n                        case 2:\n                          client = _d.sent();\n                          return [3\n                          /*break*/\n                          , 4];\n\n                        case 3:\n                          err_1 = _d.sent();\n                          observer.error({\n                            message: 'Failed to connect',\n                            error: err_1\n                          });\n                          observer.complete();\n                          return [2\n                          /*return*/\n                          , undefined];\n\n                        case 4:\n                          // subscribe to all topics for this client\n                          // store topic-client mapping\n                          topics.forEach(function (topic) {\n                            if (client.isConnected()) {\n                              client.subscribe(topic);\n\n                              _this._topicClient.set(topic, client);\n                            }\n                          });\n                          return [2\n                          /*return*/\n                          , client];\n                      }\n                    });\n                  });\n                }))];\n\n              case 1:\n                // reconnect everything we have in the map\n                _b.sent();\n\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      })();\n\n      return function () {\n        logger.debug('Unsubscribing from topic(s)', targetTopics.join(','));\n        targetTopics.forEach(function (t) {\n          var client = _this._topicClient.get(t);\n\n          if (client && client.isConnected()) {\n            client.unsubscribe(t);\n\n            _this._topicClient.delete(t);\n\n            if (!Array.from(_this._topicClient.values()).some(function (c) {\n              return c === client;\n            })) {\n              _this.disconnect(client.clientId);\n            }\n          }\n\n          _this._topicObservers.delete(t);\n        });\n      };\n    });\n    return Observable.from(result).map(function (value) {\n      var topic = _this.getTopicForValue(value);\n\n      var alias = _this._topicAlias.get(topic);\n\n      value.data = Object.entries(value.data).reduce(function (obj, _a) {\n        var _b = __read(_a, 2),\n            origKey = _b[0],\n            val = _b[1];\n\n        return obj[alias || origKey] = val, obj;\n      }, {});\n      return value;\n    });\n  };\n\n  return AWSAppSyncProvider;\n}(MqttOverWSProvider);\n\nexport { AWSAppSyncProvider };","map":{"version":3,"mappings":"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","names":["Observable","ConsoleLogger","Logger","MqttOverWSProvider","logger","__extends","_this","Map","Object","AWSAppSyncProvider","Error","topics","msg","options","clientId","topicsForClient","Array","from","_topicClient","entries","filter","_a","_b","c","map","t","forEach","_cleanUpForTopic","topic","delete","_topicAlias","errorCode","args","_topicObservers","has","get","obs","closed","error","_cleanUp","clientsQueue","client","_super","disconnect","call","result","targetTopics","concat","debug","join","set","Set","add","observer","newSubscriptions","newAliases","alias","v","__spread","reduce","acc","elem","connectionInfoForTopic","mqttConnections","find","indexOf","url","Promise","all","_c","connect","_d","message","err_1","complete","undefined","isConnected","subscribe","unsubscribe","values","some","getTopicForValue","value","data","obj","origKey","val"],"sources":["/Users/arnavmisra/Desktop/Portfolio-main/Portfolio/node_modules/@aws-amplify/pubsub/src/Providers/AWSAppSyncProvider.ts"],"sourcesContent":["/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nimport { Client } from 'paho-mqtt';\nimport Observable from 'zen-observable-ts';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\n\nimport { MqttOverWSProvider } from './MqttOverWSProvider';\n\nconst logger = new Logger('AWSAppSyncProvider');\n\n/**\n * @deprecated Unused, all usecases have migrated to AWSAppSyncRealtimeProvider\n */\nexport class AWSAppSyncProvider extends MqttOverWSProvider {\n\tprotected get endpoint() {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tgetProviderName() {\n\t\treturn 'AWSAppSyncProvider';\n\t}\n\n\tpublic async publish(topics: string[] | string, msg: any, options?: any) {\n\t\tthrow new Error('Operation not supported');\n\t}\n\n\tprivate _cleanUp(clientId: string) {\n\t\tconst topicsForClient = Array.from(this._topicClient.entries())\n\t\t\t.filter(([, c]) => c.clientId === clientId)\n\t\t\t.map(([t]) => t);\n\n\t\ttopicsForClient.forEach(t => this._cleanUpForTopic(t));\n\t}\n\n\tprivate _cleanUpForTopic(topic) {\n\t\tthis._topicClient.delete(topic);\n\t\tthis._topicAlias.delete(topic);\n\t}\n\n\tpublic onDisconnect({ clientId, errorCode, ...args }) {\n\t\tif (errorCode !== 0) {\n\t\t\tconst topicsForClient = Array.from(this._topicClient.entries())\n\t\t\t\t.filter(([, c]) => c.clientId === clientId)\n\t\t\t\t.map(([t]) => t);\n\n\t\t\ttopicsForClient.forEach(topic => {\n\t\t\t\tif (this._topicObservers.has(topic)) {\n\t\t\t\t\tthis._topicObservers.get(topic).forEach(obs => {\n\t\t\t\t\t\tif (!obs.closed) {\n\t\t\t\t\t\t\tobs.error(args);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._topicObservers.delete(topic);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._cleanUp(clientId);\n\t\t}\n\t}\n\n\tprivate _topicClient: Map<string, Client> = new Map();\n\n\tprivate _topicAlias: Map<string, string> = new Map();\n\n\tprotected async disconnect(clientId: string): Promise<void> {\n\t\tconst client = await this.clientsQueue.get(clientId, () => null);\n\n\t\tawait super.disconnect(clientId);\n\n\t\tthis._cleanUp(clientId);\n\t}\n\n\tsubscribe(topics: string[] | string, options: any = {}): Observable<any> {\n\t\tconst result = new Observable<any>(observer => {\n\t\t\tconst targetTopics = ([] as string[]).concat(topics);\n\t\t\tlogger.debug('Subscribing to topic(s)', targetTopics.join(','));\n\n\t\t\t(async () => {\n\t\t\t\t// Add these topics to map\n\t\t\t\ttargetTopics.forEach(t => {\n\t\t\t\t\tif (!this._topicObservers.has(t)) {\n\t\t\t\t\t\tthis._topicObservers.set(t, new Set());\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._topicObservers.get(t).add(observer);\n\t\t\t\t});\n\n\t\t\t\tconst { mqttConnections = [], newSubscriptions } = options;\n\n\t\t\t\t// creates a map of {\"topic\": \"alias\"}\n\t\t\t\tconst newAliases = Object.entries(newSubscriptions).map(\n\t\t\t\t\t([alias, v]: [string, { topic: string }]) => [v.topic, alias]\n\t\t\t\t);\n\n\t\t\t\t// Merge new aliases with old ones\n\t\t\t\tthis._topicAlias = new Map([\n\t\t\t\t\t...Array.from(this._topicAlias.entries()),\n\t\t\t\t\t...(newAliases as [string, string][]),\n\t\t\t\t]);\n\n\t\t\t\t// group by urls\n\t\t\t\tconst map: [string, { url: string; topics: Set<string> }][] =\n\t\t\t\t\tObject.entries(\n\t\t\t\t\t\ttargetTopics.reduce((acc, elem) => {\n\t\t\t\t\t\t\tconst connectionInfoForTopic = mqttConnections.find(\n\t\t\t\t\t\t\t\tc => c.topics.indexOf(elem) > -1\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (connectionInfoForTopic) {\n\t\t\t\t\t\t\t\tconst { client: clientId, url } = connectionInfoForTopic;\n\n\t\t\t\t\t\t\t\tif (!acc[clientId]) {\n\t\t\t\t\t\t\t\t\tacc[clientId] = {\n\t\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\t\ttopics: new Set(),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tacc[clientId].topics.add(elem);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t}, {})\n\t\t\t\t\t);\n\n\t\t\t\t// reconnect everything we have in the map\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tmap.map(async ([clientId, { url, topics }]) => {\n\t\t\t\t\t\t// connect to new client\n\t\t\t\t\t\tlet client = null;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tclient = await this.connect(clientId, {\n\t\t\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tobserver.error({ message: 'Failed to connect', error: err });\n\t\t\t\t\t\t\tobserver.complete();\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// subscribe to all topics for this client\n\t\t\t\t\t\t// store topic-client mapping\n\t\t\t\t\t\ttopics.forEach(topic => {\n\t\t\t\t\t\t\tif (client.isConnected()) {\n\t\t\t\t\t\t\t\tclient.subscribe(topic);\n\n\t\t\t\t\t\t\t\tthis._topicClient.set(topic, client);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn client;\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t})();\n\n\t\t\treturn () => {\n\t\t\t\tlogger.debug('Unsubscribing from topic(s)', targetTopics.join(','));\n\n\t\t\t\ttargetTopics.forEach(t => {\n\t\t\t\t\tconst client = this._topicClient.get(t);\n\n\t\t\t\t\tif (client && client.isConnected()) {\n\t\t\t\t\t\tclient.unsubscribe(t);\n\t\t\t\t\t\tthis._topicClient.delete(t);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!Array.from(this._topicClient.values()).some(c => c === client)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.disconnect(client.clientId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._topicObservers.delete(t);\n\t\t\t\t});\n\t\t\t};\n\t\t});\n\n\t\treturn Observable.from(result).map(value => {\n\t\t\tconst topic = this.getTopicForValue(value);\n\t\t\tconst alias = this._topicAlias.get(topic);\n\n\t\t\tvalue.data = Object.entries(value.data).reduce(\n\t\t\t\t(obj, [origKey, val]) => (\n\t\t\t\t\t(obj[(alias || origKey) as string] = val), obj\n\t\t\t\t),\n\t\t\t\t{}\n\t\t\t);\n\n\t\t\treturn value;\n\t\t});\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}