{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { parse } from 'url'; // Used for OAuth parsing of Cognito Hosted UI\n\nimport { launchUri } from './urlOpener';\nimport * as oAuthStorage from './oauthStorage';\nimport { isCognitoHostedOpts, CognitoHostedUIIdentityProvider } from '../types/Auth';\nimport { ConsoleLogger as Logger, Hub, urlSafeEncode } from '@aws-amplify/core';\nimport sha256 from 'crypto-js/sha256';\nimport Base64 from 'crypto-js/enc-base64';\nvar AMPLIFY_SYMBOL = typeof Symbol !== 'undefined' && typeof Symbol.for === 'function' ? Symbol.for('amplify_default') : '@@amplify_default';\n\nvar dispatchAuthEvent = function (event, data, message) {\n  Hub.dispatch('auth', {\n    event: event,\n    data: data,\n    message: message\n  }, 'Auth', AMPLIFY_SYMBOL);\n};\n\nvar logger = new Logger('OAuth');\n\nvar OAuth =\n/** @class */\nfunction () {\n  function OAuth(_a) {\n    var config = _a.config,\n        cognitoClientId = _a.cognitoClientId,\n        _b = _a.scopes,\n        scopes = _b === void 0 ? [] : _b;\n    this._urlOpener = config.urlOpener || launchUri;\n    this._config = config;\n    this._cognitoClientId = cognitoClientId;\n    if (!this.isValidScopes(scopes)) throw Error('scopes must be a String Array');\n    this._scopes = scopes;\n  }\n\n  OAuth.prototype.isValidScopes = function (scopes) {\n    return Array.isArray(scopes) && scopes.every(function (scope) {\n      return typeof scope === 'string';\n    });\n  };\n\n  OAuth.prototype.oauthSignIn = function (responseType, domain, redirectSignIn, clientId, provider, customState) {\n    if (responseType === void 0) {\n      responseType = 'code';\n    }\n\n    if (provider === void 0) {\n      provider = CognitoHostedUIIdentityProvider.Cognito;\n    }\n\n    var generatedState = this._generateState(32);\n    /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n    single-encodes/decodes url on first sign in and double-encodes/decodes url\n    when user already signed in. Using encodeURIComponent, Base32, Base64 add\n    characters % or = which on further encoding becomes unsafe. '=' create issue\n    for parsing query params.\n    Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n\n\n    var state = customState ? generatedState + \"-\" + urlSafeEncode(customState) : generatedState;\n    oAuthStorage.setState(state);\n\n    var pkce_key = this._generateRandom(128);\n\n    oAuthStorage.setPKCE(pkce_key);\n\n    var code_challenge = this._generateChallenge(pkce_key);\n\n    var code_challenge_method = 'S256';\n\n    var scopesString = this._scopes.join(' ');\n\n    var queryString = Object.entries(__assign(__assign({\n      redirect_uri: redirectSignIn,\n      response_type: responseType,\n      client_id: clientId,\n      identity_provider: provider,\n      scope: scopesString,\n      state: state\n    }, responseType === 'code' ? {\n      code_challenge: code_challenge\n    } : {}), responseType === 'code' ? {\n      code_challenge_method: code_challenge_method\n    } : {})).map(function (_a) {\n      var _b = __read(_a, 2),\n          k = _b[0],\n          v = _b[1];\n\n      return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n    }).join('&');\n    var URL = \"https://\" + domain + \"/oauth2/authorize?\" + queryString;\n    logger.debug(\"Redirecting to \" + URL);\n\n    this._urlOpener(URL, redirectSignIn);\n  };\n\n  OAuth.prototype._handleCodeFlow = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var code, currentUrlPathname, redirectSignInPathname, oAuthTokenEndpoint, client_id, redirect_uri, code_verifier, oAuthTokenBody, body, _a, access_token, refresh_token, id_token, error;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            code = (parse(currentUrl).query || '').split('&').map(function (pairings) {\n              return pairings.split('=');\n            }).reduce(function (accum, _a) {\n              var _b;\n\n              var _c = __read(_a, 2),\n                  k = _c[0],\n                  v = _c[1];\n\n              return __assign(__assign({}, accum), (_b = {}, _b[k] = v, _b));\n            }, {\n              code: undefined\n            }).code;\n            currentUrlPathname = parse(currentUrl).pathname || '/';\n            redirectSignInPathname = parse(this._config.redirectSignIn).pathname || '/';\n\n            if (!code || currentUrlPathname !== redirectSignInPathname) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            oAuthTokenEndpoint = 'https://' + this._config.domain + '/oauth2/token';\n            dispatchAuthEvent('codeFlow', {}, \"Retrieving tokens from \" + oAuthTokenEndpoint);\n            client_id = isCognitoHostedOpts(this._config) ? this._cognitoClientId : this._config.clientID;\n            redirect_uri = isCognitoHostedOpts(this._config) ? this._config.redirectSignIn : this._config.redirectUri;\n            code_verifier = oAuthStorage.getPKCE();\n            oAuthTokenBody = __assign({\n              grant_type: 'authorization_code',\n              code: code,\n              client_id: client_id,\n              redirect_uri: redirect_uri\n            }, code_verifier ? {\n              code_verifier: code_verifier\n            } : {});\n            logger.debug(\"Calling token endpoint: \" + oAuthTokenEndpoint + \" with\", oAuthTokenBody);\n            body = Object.entries(oAuthTokenBody).map(function (_a) {\n              var _b = __read(_a, 2),\n                  k = _b[0],\n                  v = _b[1];\n\n              return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n            }).join('&');\n            return [4\n            /*yield*/\n            , fetch(oAuthTokenEndpoint, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/x-www-form-urlencoded'\n              },\n              body: body\n            })];\n\n          case 1:\n            return [4\n            /*yield*/\n            , _b.sent().json()];\n\n          case 2:\n            _a = _b.sent(), access_token = _a.access_token, refresh_token = _a.refresh_token, id_token = _a.id_token, error = _a.error;\n\n            if (error) {\n              throw new Error(error);\n            }\n\n            return [2\n            /*return*/\n            , {\n              accessToken: access_token,\n              refreshToken: refresh_token,\n              idToken: id_token\n            }];\n        }\n      });\n    });\n  };\n\n  OAuth.prototype._handleImplicitFlow = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, id_token, access_token;\n\n      return __generator(this, function (_b) {\n        _a = (parse(currentUrl).hash || '#').substr(1) // Remove # from returned code\n        .split('&').map(function (pairings) {\n          return pairings.split('=');\n        }).reduce(function (accum, _a) {\n          var _b;\n\n          var _c = __read(_a, 2),\n              k = _c[0],\n              v = _c[1];\n\n          return __assign(__assign({}, accum), (_b = {}, _b[k] = v, _b));\n        }, {\n          id_token: undefined,\n          access_token: undefined\n        }), id_token = _a.id_token, access_token = _a.access_token;\n        dispatchAuthEvent('implicitFlow', {}, \"Got tokens from \" + currentUrl);\n        logger.debug(\"Retrieving implicit tokens from \" + currentUrl + \" with\");\n        return [2\n        /*return*/\n        , {\n          accessToken: access_token,\n          idToken: id_token,\n          refreshToken: null\n        }];\n      });\n    });\n  };\n\n  OAuth.prototype.handleAuthResponse = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var urlParams, error, error_description, state, _a, _b, e_1;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _c.trys.push([0, 5,, 6]);\n\n            urlParams = currentUrl ? __assign(__assign({}, (parse(currentUrl).hash || '#').substr(1).split('&').map(function (entry) {\n              return entry.split('=');\n            }).reduce(function (acc, _a) {\n              var _b = __read(_a, 2),\n                  k = _b[0],\n                  v = _b[1];\n\n              return acc[k] = v, acc;\n            }, {})), (parse(currentUrl).query || '').split('&').map(function (entry) {\n              return entry.split('=');\n            }).reduce(function (acc, _a) {\n              var _b = __read(_a, 2),\n                  k = _b[0],\n                  v = _b[1];\n\n              return acc[k] = v, acc;\n            }, {})) : {};\n            error = urlParams.error, error_description = urlParams.error_description;\n\n            if (error) {\n              throw new Error(error_description);\n            }\n\n            state = this._validateState(urlParams);\n            logger.debug(\"Starting \" + this._config.responseType + \" flow with \" + currentUrl);\n            if (!(this._config.responseType === 'code')) return [3\n            /*break*/\n            , 2];\n            _a = [{}];\n            return [4\n            /*yield*/\n            , this._handleCodeFlow(currentUrl)];\n\n          case 1:\n            return [2\n            /*return*/\n            , __assign.apply(void 0, [__assign.apply(void 0, _a.concat([_c.sent()])), {\n              state: state\n            }])];\n\n          case 2:\n            _b = [{}];\n            return [4\n            /*yield*/\n            , this._handleImplicitFlow(currentUrl)];\n\n          case 3:\n            return [2\n            /*return*/\n            , __assign.apply(void 0, [__assign.apply(void 0, _b.concat([_c.sent()])), {\n              state: state\n            }])];\n\n          case 4:\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            e_1 = _c.sent();\n            logger.error(\"Error handling auth response.\", e_1);\n            throw e_1;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  OAuth.prototype._validateState = function (urlParams) {\n    if (!urlParams) {\n      return;\n    }\n\n    var savedState = oAuthStorage.getState();\n    var returnedState = urlParams.state; // This is because savedState only exists if the flow was initiated by Amplify\n\n    if (savedState && savedState !== returnedState) {\n      throw new Error('Invalid state in OAuth flow');\n    }\n\n    return returnedState;\n  };\n\n  OAuth.prototype.signOut = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var oAuthLogoutEndpoint, client_id, signout_uri;\n      return __generator(this, function (_a) {\n        oAuthLogoutEndpoint = 'https://' + this._config.domain + '/logout?';\n        client_id = isCognitoHostedOpts(this._config) ? this._cognitoClientId : this._config.oauth.clientID;\n        signout_uri = isCognitoHostedOpts(this._config) ? this._config.redirectSignOut : this._config.returnTo;\n        oAuthLogoutEndpoint += Object.entries({\n          client_id: client_id,\n          logout_uri: encodeURIComponent(signout_uri)\n        }).map(function (_a) {\n          var _b = __read(_a, 2),\n              k = _b[0],\n              v = _b[1];\n\n          return k + \"=\" + v;\n        }).join('&');\n        dispatchAuthEvent('oAuthSignOut', {\n          oAuth: 'signOut'\n        }, \"Signing out from \" + oAuthLogoutEndpoint);\n        logger.debug(\"Signing out from \" + oAuthLogoutEndpoint);\n        return [2\n        /*return*/\n        , this._urlOpener(oAuthLogoutEndpoint, signout_uri)];\n      });\n    });\n  };\n\n  OAuth.prototype._generateState = function (length) {\n    var result = '';\n    var i = length;\n    var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\n    for (; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n\n    return result;\n  };\n\n  OAuth.prototype._generateChallenge = function (code) {\n    return this._base64URL(sha256(code));\n  };\n\n  OAuth.prototype._base64URL = function (string) {\n    return string.toString(Base64).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n  };\n\n  OAuth.prototype._generateRandom = function (size) {\n    var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';\n    var buffer = new Uint8Array(size);\n\n    if (typeof window !== 'undefined' && !!window.crypto) {\n      window.crypto.getRandomValues(buffer);\n    } else {\n      for (var i = 0; i < size; i += 1) {\n        buffer[i] = Math.random() * CHARSET.length | 0;\n      }\n    }\n\n    return this._bufferToString(buffer);\n  };\n\n  OAuth.prototype._bufferToString = function (buffer) {\n    var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    var state = [];\n\n    for (var i = 0; i < buffer.byteLength; i += 1) {\n      var index = buffer[i] % CHARSET.length;\n      state.push(CHARSET[index]);\n    }\n\n    return state.join('');\n  };\n\n  return OAuth;\n}();\n\nexport default OAuth;","map":{"version":3,"mappings":"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","names":["parse","launchUri","oAuthStorage","isCognitoHostedOpts","CognitoHostedUIIdentityProvider","ConsoleLogger","Logger","Hub","urlSafeEncode","sha256","Base64","AMPLIFY_SYMBOL","Symbol","for","dispatchAuthEvent","event","data","message","dispatch","logger","_a","config","cognitoClientId","_b","scopes","_urlOpener","urlOpener","_config","_cognitoClientId","isValidScopes","Error","_scopes","OAuth","Array","isArray","every","scope","responseType","domain","redirectSignIn","clientId","provider","customState","Cognito","generatedState","_generateState","state","setState","pkce_key","_generateRandom","setPKCE","code_challenge","_generateChallenge","code_challenge_method","scopesString","join","queryString","Object","entries","__assign","redirect_uri","response_type","client_id","identity_provider","map","k","v","encodeURIComponent","URL","debug","currentUrl","code","query","split","reduce","accum","_c","undefined","currentUrlPathname","pathname","redirectSignInPathname","oAuthTokenEndpoint","clientID","redirectUri","code_verifier","getPKCE","oAuthTokenBody","grant_type","body","fetch","method","headers","json","access_token","refresh_token","id_token","error","accessToken","refreshToken","idToken","hash","substr","urlParams","acc","error_description","_validateState","_handleCodeFlow","_handleImplicitFlow","e_1","savedState","getState","returnedState","oAuthLogoutEndpoint","oauth","signout_uri","redirectSignOut","returnTo","logout_uri","oAuth","length","result","i","chars","Math","round","random","_base64URL","string","toString","replace","size","CHARSET","buffer","Uint8Array","window","crypto","getRandomValues","_bufferToString","byteLength","index","push"],"sources":["/Users/arnavmisra/Desktop/Portfolio-main/Portfolio/node_modules/@aws-amplify/auth/src/OAuth/OAuth.ts"],"sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nimport { parse } from 'url'; // Used for OAuth parsing of Cognito Hosted UI\nimport { launchUri } from './urlOpener';\nimport * as oAuthStorage from './oauthStorage';\n\nimport {\n\tOAuthOpts,\n\tisCognitoHostedOpts,\n\tCognitoHostedUIIdentityProvider,\n} from '../types/Auth';\n\nimport { ConsoleLogger as Logger, Hub, urlSafeEncode } from '@aws-amplify/core';\n\nimport sha256 from 'crypto-js/sha256';\nimport Base64 from 'crypto-js/enc-base64';\n\nconst AMPLIFY_SYMBOL = (typeof Symbol !== 'undefined' &&\ntypeof Symbol.for === 'function'\n\t? Symbol.for('amplify_default')\n\t: '@@amplify_default') as Symbol;\n\nconst dispatchAuthEvent = (event: string, data: any, message: string) => {\n\tHub.dispatch('auth', { event, data, message }, 'Auth', AMPLIFY_SYMBOL);\n};\n\nconst logger = new Logger('OAuth');\n\nexport default class OAuth {\n\tprivate _urlOpener;\n\tprivate _config;\n\tprivate _cognitoClientId;\n\tprivate _scopes;\n\n\tconstructor({\n\t\tconfig,\n\t\tcognitoClientId,\n\t\tscopes = [],\n\t}: {\n\t\tscopes: string[];\n\t\tconfig: OAuthOpts;\n\t\tcognitoClientId: string;\n\t}) {\n\t\tthis._urlOpener = config.urlOpener || launchUri;\n\t\tthis._config = config;\n\t\tthis._cognitoClientId = cognitoClientId;\n\n\t\tif (!this.isValidScopes(scopes))\n\t\t\tthrow Error('scopes must be a String Array');\n\t\tthis._scopes = scopes;\n\t}\n\n\tprivate isValidScopes(scopes: string[]) {\n\t\treturn (\n\t\t\tArray.isArray(scopes) && scopes.every(scope => typeof scope === 'string')\n\t\t);\n\t}\n\n\tpublic oauthSignIn(\n\t\tresponseType = 'code',\n\t\tdomain: string,\n\t\tredirectSignIn: string,\n\t\tclientId: string,\n\t\tprovider:\n\t\t\t| CognitoHostedUIIdentityProvider\n\t\t\t| string = CognitoHostedUIIdentityProvider.Cognito,\n\t\tcustomState?: string\n\t) {\n\t\tconst generatedState = this._generateState(32);\n\n\t\t/* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito \n\t\tsingle-encodes/decodes url on first sign in and double-encodes/decodes url\n\t\twhen user already signed in. Using encodeURIComponent, Base32, Base64 add \n\t\tcharacters % or = which on further encoding becomes unsafe. '=' create issue \n\t\tfor parsing query params. \n\t\tRefer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n\t\tconst state = customState\n\t\t\t? `${generatedState}-${urlSafeEncode(customState)}`\n\t\t\t: generatedState;\n\n\t\toAuthStorage.setState(state);\n\n\t\tconst pkce_key = this._generateRandom(128);\n\t\toAuthStorage.setPKCE(pkce_key);\n\n\t\tconst code_challenge = this._generateChallenge(pkce_key);\n\t\tconst code_challenge_method = 'S256';\n\n\t\tconst scopesString = this._scopes.join(' ');\n\n\t\tconst queryString = Object.entries({\n\t\t\tredirect_uri: redirectSignIn,\n\t\t\tresponse_type: responseType,\n\t\t\tclient_id: clientId,\n\t\t\tidentity_provider: provider,\n\t\t\tscope: scopesString,\n\t\t\tstate,\n\t\t\t...(responseType === 'code' ? { code_challenge } : {}),\n\t\t\t...(responseType === 'code' ? { code_challenge_method } : {}),\n\t\t})\n\t\t\t.map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n\t\t\t.join('&');\n\n\t\tconst URL = `https://${domain}/oauth2/authorize?${queryString}`;\n\t\tlogger.debug(`Redirecting to ${URL}`);\n\t\tthis._urlOpener(URL, redirectSignIn);\n\t}\n\n\tprivate async _handleCodeFlow(currentUrl: string) {\n\t\t/* Convert URL into an object with parameters as keys\n    { redirect_uri: 'http://localhost:3000/', response_type: 'code', ...} */\n\t\tconst { code } = (parse(currentUrl).query || '')\n\t\t\t.split('&')\n\t\t\t.map(pairings => pairings.split('='))\n\t\t\t.reduce((accum, [k, v]) => ({ ...accum, [k]: v }), { code: undefined });\n\n\t\tconst currentUrlPathname = parse(currentUrl).pathname || '/';\n\t\tconst redirectSignInPathname =\n\t\t\tparse(this._config.redirectSignIn).pathname || '/';\n\n\t\tif (!code || currentUrlPathname !== redirectSignInPathname) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst oAuthTokenEndpoint =\n\t\t\t'https://' + this._config.domain + '/oauth2/token';\n\n\t\tdispatchAuthEvent(\n\t\t\t'codeFlow',\n\t\t\t{},\n\t\t\t`Retrieving tokens from ${oAuthTokenEndpoint}`\n\t\t);\n\n\t\tconst client_id = isCognitoHostedOpts(this._config)\n\t\t\t? this._cognitoClientId\n\t\t\t: this._config.clientID;\n\n\t\tconst redirect_uri = isCognitoHostedOpts(this._config)\n\t\t\t? this._config.redirectSignIn\n\t\t\t: this._config.redirectUri;\n\n\t\tconst code_verifier = oAuthStorage.getPKCE();\n\n\t\tconst oAuthTokenBody = {\n\t\t\tgrant_type: 'authorization_code',\n\t\t\tcode,\n\t\t\tclient_id,\n\t\t\tredirect_uri,\n\t\t\t...(code_verifier ? { code_verifier } : {}),\n\t\t};\n\n\t\tlogger.debug(\n\t\t\t`Calling token endpoint: ${oAuthTokenEndpoint} with`,\n\t\t\toAuthTokenBody\n\t\t);\n\n\t\tconst body = Object.entries(oAuthTokenBody)\n\t\t\t.map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n\t\t\t.join('&');\n\n\t\tconst {\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tid_token,\n\t\t\terror,\n\t\t} = await ((await fetch(oAuthTokenEndpoint, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody,\n\t\t})) as any).json();\n\n\t\tif (error) {\n\t\t\tthrow new Error(error);\n\t\t}\n\n\t\treturn {\n\t\t\taccessToken: access_token,\n\t\t\trefreshToken: refresh_token,\n\t\t\tidToken: id_token,\n\t\t};\n\t}\n\n\tprivate async _handleImplicitFlow(currentUrl: string) {\n\t\t// hash is `null` if `#` doesn't exist on URL\n\t\tconst { id_token, access_token } = (parse(currentUrl).hash || '#')\n\t\t\t.substr(1) // Remove # from returned code\n\t\t\t.split('&')\n\t\t\t.map(pairings => pairings.split('='))\n\t\t\t.reduce((accum, [k, v]) => ({ ...accum, [k]: v }), {\n\t\t\t\tid_token: undefined,\n\t\t\t\taccess_token: undefined,\n\t\t\t});\n\n\t\tdispatchAuthEvent('implicitFlow', {}, `Got tokens from ${currentUrl}`);\n\t\tlogger.debug(`Retrieving implicit tokens from ${currentUrl} with`);\n\n\t\treturn {\n\t\t\taccessToken: access_token,\n\t\t\tidToken: id_token,\n\t\t\trefreshToken: null,\n\t\t};\n\t}\n\n\tpublic async handleAuthResponse(currentUrl?: string) {\n\t\ttry {\n\t\t\tconst urlParams = currentUrl\n\t\t\t\t? ({\n\t\t\t\t\t\t...(parse(currentUrl).hash || '#')\n\t\t\t\t\t\t\t.substr(1)\n\t\t\t\t\t\t\t.split('&')\n\t\t\t\t\t\t\t.map(entry => entry.split('='))\n\t\t\t\t\t\t\t.reduce((acc, [k, v]) => ((acc[k] = v), acc), {}),\n\t\t\t\t\t\t...(parse(currentUrl).query || '')\n\t\t\t\t\t\t\t.split('&')\n\t\t\t\t\t\t\t.map(entry => entry.split('='))\n\t\t\t\t\t\t\t.reduce((acc, [k, v]) => ((acc[k] = v), acc), {}),\n\t\t\t\t  } as any)\n\t\t\t\t: {};\n\t\t\tconst { error, error_description } = urlParams;\n\n\t\t\tif (error) {\n\t\t\t\tthrow new Error(error_description);\n\t\t\t}\n\n\t\t\tconst state: string = this._validateState(urlParams);\n\n\t\t\tlogger.debug(\n\t\t\t\t`Starting ${this._config.responseType} flow with ${currentUrl}`\n\t\t\t);\n\t\t\tif (this._config.responseType === 'code') {\n\t\t\t\treturn { ...(await this._handleCodeFlow(currentUrl)), state };\n\t\t\t} else {\n\t\t\t\treturn { ...(await this._handleImplicitFlow(currentUrl)), state };\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlogger.error(`Error handling auth response.`, e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tprivate _validateState(urlParams: any): string {\n\t\tif (!urlParams) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst savedState = oAuthStorage.getState();\n\t\tconst { state: returnedState } = urlParams;\n\n\t\t// This is because savedState only exists if the flow was initiated by Amplify\n\t\tif (savedState && savedState !== returnedState) {\n\t\t\tthrow new Error('Invalid state in OAuth flow');\n\t\t}\n\t\treturn returnedState;\n\t}\n\n\tpublic async signOut() {\n\t\tlet oAuthLogoutEndpoint = 'https://' + this._config.domain + '/logout?';\n\n\t\tconst client_id = isCognitoHostedOpts(this._config)\n\t\t\t? this._cognitoClientId\n\t\t\t: this._config.oauth.clientID;\n\n\t\tconst signout_uri = isCognitoHostedOpts(this._config)\n\t\t\t? this._config.redirectSignOut\n\t\t\t: this._config.returnTo;\n\n\t\toAuthLogoutEndpoint += Object.entries({\n\t\t\tclient_id,\n\t\t\tlogout_uri: encodeURIComponent(signout_uri),\n\t\t})\n\t\t\t.map(([k, v]) => `${k}=${v}`)\n\t\t\t.join('&');\n\n\t\tdispatchAuthEvent(\n\t\t\t'oAuthSignOut',\n\t\t\t{ oAuth: 'signOut' },\n\t\t\t`Signing out from ${oAuthLogoutEndpoint}`\n\t\t);\n\t\tlogger.debug(`Signing out from ${oAuthLogoutEndpoint}`);\n\n\t\treturn this._urlOpener(oAuthLogoutEndpoint, signout_uri);\n\t}\n\n\tprivate _generateState(length: number) {\n\t\tlet result = '';\n\t\tlet i = length;\n\t\tconst chars =\n\t\t\t'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\tfor (; i > 0; --i)\n\t\t\tresult += chars[Math.round(Math.random() * (chars.length - 1))];\n\t\treturn result;\n\t}\n\n\tprivate _generateChallenge(code: string) {\n\t\treturn this._base64URL(sha256(code));\n\t}\n\n\tprivate _base64URL(string) {\n\t\treturn string\n\t\t\t.toString(Base64)\n\t\t\t.replace(/=/g, '')\n\t\t\t.replace(/\\+/g, '-')\n\t\t\t.replace(/\\//g, '_');\n\t}\n\n\tprivate _generateRandom(size: number) {\n\t\tconst CHARSET =\n\t\t\t'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';\n\t\tconst buffer = new Uint8Array(size);\n\t\tif (typeof window !== 'undefined' && !!window.crypto) {\n\t\t\twindow.crypto.getRandomValues(buffer);\n\t\t} else {\n\t\t\tfor (let i = 0; i < size; i += 1) {\n\t\t\t\tbuffer[i] = (Math.random() * CHARSET.length) | 0;\n\t\t\t}\n\t\t}\n\t\treturn this._bufferToString(buffer);\n\t}\n\n\tprivate _bufferToString(buffer: Uint8Array) {\n\t\tconst CHARSET =\n\t\t\t'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\t\tconst state = [];\n\t\tfor (let i = 0; i < buffer.byteLength; i += 1) {\n\t\t\tconst index = buffer[i] % CHARSET.length;\n\t\t\tstate.push(CHARSET[index]);\n\t\t}\n\t\treturn state.join('');\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}