{"ast":null,"code":"var HTML5_MEDIA_EVENT;\n\n(function (HTML5_MEDIA_EVENT) {\n  HTML5_MEDIA_EVENT[\"PLAY\"] = \"play\";\n  HTML5_MEDIA_EVENT[\"PAUSE\"] = \"pause\";\n  HTML5_MEDIA_EVENT[\"ENDED\"] = \"Ended\";\n})(HTML5_MEDIA_EVENT || (HTML5_MEDIA_EVENT = {}));\n\nvar MEDIA_TYPE;\n\n(function (MEDIA_TYPE) {\n  MEDIA_TYPE[\"IFRAME\"] = \"IFRAME\";\n  MEDIA_TYPE[\"VIDEO\"] = \"VIDEO\";\n  MEDIA_TYPE[\"AUDIO\"] = \"AUDIO\";\n})(MEDIA_TYPE || (MEDIA_TYPE = {}));\n\nvar EVENT_TYPE;\n\n(function (EVENT_TYPE) {\n  EVENT_TYPE[\"PLAY\"] = \"Play\";\n  EVENT_TYPE[\"ENDED\"] = \"Ended\";\n  EVENT_TYPE[\"PAUSE\"] = \"Pause\";\n  EVENT_TYPE[\"TIME_WATCHED\"] = \"TimeWatched\";\n})(EVENT_TYPE || (EVENT_TYPE = {}));\n\nvar MediaAutoTrack =\n/** @class */\nfunction () {\n  function MediaAutoTrack(params, provider) {\n    var _a;\n\n    this.eventActionMapping = (_a = {}, _a[EVENT_TYPE.ENDED] = this.endedEventAction.bind(this), _a[EVENT_TYPE.PLAY] = this.playEventAction.bind(this), _a[EVENT_TYPE.PAUSE] = this.pauseEventAction.bind(this), _a);\n    var eventData = params.eventData;\n    this._params = params;\n    this._mediaElement = document.getElementById(eventData.properties['domElementId']);\n    this._started = false;\n    this._provider = provider;\n    var mediaTrackFunMapping = {\n      IFRAME: this._iframeMediaTracker,\n      VIDEO: this._html5MediaTracker,\n      AUDIO: this._html5MediaTracker\n    };\n\n    mediaTrackFunMapping[this._mediaElement.tagName].bind(this)();\n\n    this._initYoutubeFrame();\n  }\n\n  MediaAutoTrack.prototype._initYoutubeFrame = function () {\n    this._youTubeIframeLoader = {\n      src: 'https://www.youtube.com/iframe_api',\n      loading: false,\n      loaded: false,\n      listeners: [],\n      load: function (callback) {\n        var _this = this;\n\n        this.listeners.push(callback);\n\n        if (this.loaded) {\n          setTimeout(function () {\n            _this.done();\n          });\n          return;\n        }\n\n        if (this.loading) {\n          return;\n        }\n\n        this.loading = true;\n\n        window['onYouTubeIframeAPIReady'] = function () {\n          _this.loaded = true;\n\n          _this.done();\n        };\n\n        var script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.src = this.src;\n        document.body.appendChild(script);\n      },\n      done: function () {\n        delete window['onYouTubeIframeAPIReady'];\n\n        while (this.listeners.length) {\n          this.listeners.pop()(window['YT']);\n        }\n      }\n    };\n  };\n\n  MediaAutoTrack.prototype._iframeMediaTracker = function () {\n    var that = this;\n    setInterval(function () {\n      if (that._started) {\n        that.recordEvent(MEDIA_TYPE.IFRAME, EVENT_TYPE.TIME_WATCHED);\n      }\n    }, 3 * 1000);\n\n    this._youTubeIframeLoader.load(function (YT) {\n      that._iframePlayer = new YT.Player(that._mediaElement.id, {\n        events: {\n          onStateChange: that._onPlayerStateChange.bind(that)\n        }\n      });\n    });\n  };\n\n  MediaAutoTrack.prototype._onPlayerStateChange = function (event) {\n    var iframeEventMapping = {\n      0: EVENT_TYPE.ENDED,\n      1: EVENT_TYPE.PLAY,\n      2: EVENT_TYPE.PAUSE\n    };\n    var eventType = iframeEventMapping[event.data];\n\n    if (eventType) {\n      this.eventActionMapping[eventType](MEDIA_TYPE.IFRAME);\n    }\n  };\n\n  MediaAutoTrack.prototype._html5MediaTracker = function () {\n    var that = this;\n    setInterval(function () {\n      if (that._started) {\n        that.recordEvent(MEDIA_TYPE.VIDEO, EVENT_TYPE.TIME_WATCHED);\n      }\n    }, 3 * 1000);\n\n    this._mediaElement.addEventListener(HTML5_MEDIA_EVENT.PLAY, function () {\n      that.eventActionMapping[EVENT_TYPE.PLAY](MEDIA_TYPE.VIDEO);\n    }, false);\n\n    this._mediaElement.addEventListener(HTML5_MEDIA_EVENT.PAUSE, function () {\n      that.eventActionMapping[EVENT_TYPE.PAUSE](MEDIA_TYPE.VIDEO);\n    }, false);\n\n    this._mediaElement.addEventListener(HTML5_MEDIA_EVENT.ENDED, function () {\n      that.eventActionMapping[EVENT_TYPE.ENDED](MEDIA_TYPE.VIDEO);\n    }, false);\n  };\n\n  MediaAutoTrack.prototype.playEventAction = function (mediaType) {\n    this._started = true;\n    this.recordEvent(mediaType, EVENT_TYPE.PLAY);\n  };\n\n  MediaAutoTrack.prototype.pauseEventAction = function (mediaType) {\n    this._started = false;\n    this.recordEvent(mediaType, EVENT_TYPE.PAUSE);\n  };\n\n  MediaAutoTrack.prototype.endedEventAction = function (mediaType) {\n    this._started = false;\n    this.recordEvent(mediaType, EVENT_TYPE.ENDED);\n  };\n\n  MediaAutoTrack.prototype.recordEvent = function (mediaType, eventType) {\n    var newParams = Object.assign({}, this._params);\n    var eventData = newParams.eventData;\n    eventData.eventType = eventType;\n\n    if (mediaType === MEDIA_TYPE.VIDEO) {\n      eventData.properties.timestamp = this._mediaElement.currentTime;\n      eventData.properties.duration = this._mediaElement.duration;\n    } else {\n      eventData.properties.timestamp = this._financial(this._iframePlayer.getCurrentTime());\n      eventData.properties.duration = this._financial(this._iframePlayer.getDuration());\n    }\n\n    var percentage = parseFloat(eventData.properties.timestamp) / parseFloat(eventData.properties.duration);\n    eventData.properties.eventValue = Number(percentage.toFixed(4));\n    delete eventData.properties.domElementId;\n\n    this._provider.putToBuffer(newParams);\n  };\n\n  MediaAutoTrack.prototype._financial = function (x) {\n    return Number.parseFloat(x).toFixed(4);\n  };\n\n  return MediaAutoTrack;\n}();\n\nexport { MediaAutoTrack };","map":{"version":3,"mappings":"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","names":["HTML5_MEDIA_EVENT","MEDIA_TYPE","EVENT_TYPE","params","provider","_a","ENDED","endedEventAction","bind","PLAY","playEventAction","PAUSE","pauseEventAction","_params","_mediaElement","document","getElementById","eventData","properties","_started","_provider","mediaTrackFunMapping","IFRAME","_iframeMediaTracker","VIDEO","_html5MediaTracker","AUDIO","tagName","_initYoutubeFrame","MediaAutoTrack","_youTubeIframeLoader","src","loading","loaded","listeners","load","callback","_this","push","setTimeout","done","window","script","createElement","type","body","appendChild","length","pop","that","setInterval","recordEvent","TIME_WATCHED","YT","_iframePlayer","Player","id","events","onStateChange","_onPlayerStateChange","event","iframeEventMapping","eventType","data","eventActionMapping","addEventListener","mediaType","newParams","Object","assign","timestamp","currentTime","duration","_financial","getCurrentTime","getDuration","percentage","parseFloat","eventValue","Number","toFixed","domElementId","putToBuffer","x"],"sources":["/Users/arnavmisra/Desktop/Portfolio-main/node_modules/@aws-amplify/analytics/src/Providers/AmazonPersonalizeHelper/MediaAutoTrack.ts"],"sourcesContent":["/*\n * Copyright 2019-2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nimport { RequestParams } from './DataType';\n\nenum HTML5_MEDIA_EVENT {\n\t'PLAY' = 'play',\n\t'PAUSE' = 'pause',\n\t'ENDED' = 'Ended',\n}\nenum MEDIA_TYPE {\n\t'IFRAME' = 'IFRAME',\n\t'VIDEO' = 'VIDEO',\n\t'AUDIO' = 'AUDIO',\n}\nenum EVENT_TYPE {\n\t'PLAY' = 'Play',\n\t'ENDED' = 'Ended',\n\t'PAUSE' = 'Pause',\n\t'TIME_WATCHED' = 'TimeWatched',\n}\n\nexport class MediaAutoTrack {\n\tprivate _mediaElement;\n\tprivate _provider;\n\tprivate _params;\n\tprivate _started;\n\tprivate _iframePlayer;\n\tprivate eventActionMapping = {\n\t\t[EVENT_TYPE.ENDED]: this.endedEventAction.bind(this),\n\t\t[EVENT_TYPE.PLAY]: this.playEventAction.bind(this),\n\t\t[EVENT_TYPE.PAUSE]: this.pauseEventAction.bind(this),\n\t};\n\n\tprivate _youTubeIframeLoader;\n\n\tconstructor(params: RequestParams, provider) {\n\t\tconst { eventData } = params;\n\t\tthis._params = params;\n\t\tthis._mediaElement = document.getElementById(\n\t\t\teventData.properties['domElementId']\n\t\t);\n\t\tthis._started = false;\n\t\tthis._provider = provider;\n\t\tconst mediaTrackFunMapping = {\n\t\t\tIFRAME: this._iframeMediaTracker,\n\t\t\tVIDEO: this._html5MediaTracker,\n\t\t\tAUDIO: this._html5MediaTracker,\n\t\t};\n\n\t\tmediaTrackFunMapping[this._mediaElement.tagName].bind(this)();\n\n\t\tthis._initYoutubeFrame();\n\t}\n\n\tprivate _initYoutubeFrame() {\n\t\tthis._youTubeIframeLoader = {\n\t\t\tsrc: 'https://www.youtube.com/iframe_api',\n\t\t\tloading: false,\n\t\t\tloaded: false,\n\t\t\tlisteners: [],\n\n\t\t\tload(callback) {\n\t\t\t\tconst _this = this;\n\t\t\t\tthis.listeners.push(callback);\n\n\t\t\t\tif (this.loaded) {\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t_this.done();\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.loading) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.loading = true;\n\n\t\t\t\twindow['onYouTubeIframeAPIReady'] = function() {\n\t\t\t\t\t_this.loaded = true;\n\t\t\t\t\t_this.done();\n\t\t\t\t};\n\n\t\t\t\tconst script = document.createElement('script');\n\t\t\t\tscript.type = 'text/javascript';\n\t\t\t\tscript.src = this.src;\n\t\t\t\tdocument.body.appendChild(script);\n\t\t\t},\n\n\t\t\tdone() {\n\t\t\t\tdelete window['onYouTubeIframeAPIReady'];\n\n\t\t\t\twhile (this.listeners.length) {\n\t\t\t\t\tthis.listeners.pop()(window['YT']);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tprivate _iframeMediaTracker(): void {\n\t\tconst that = this;\n\t\tsetInterval(function() {\n\t\t\tif (that._started) {\n\t\t\t\tthat.recordEvent(MEDIA_TYPE.IFRAME, EVENT_TYPE.TIME_WATCHED);\n\t\t\t}\n\t\t}, 3 * 1000);\n\t\tthis._youTubeIframeLoader.load(function(YT) {\n\t\t\tthat._iframePlayer = new YT.Player(that._mediaElement.id, {\n\t\t\t\tevents: { onStateChange: that._onPlayerStateChange.bind(that) },\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate _onPlayerStateChange(event): void {\n\t\tconst iframeEventMapping = {\n\t\t\t0: EVENT_TYPE.ENDED,\n\t\t\t1: EVENT_TYPE.PLAY,\n\t\t\t2: EVENT_TYPE.PAUSE,\n\t\t};\n\t\tconst eventType = iframeEventMapping[event.data];\n\t\tif (eventType) {\n\t\t\tthis.eventActionMapping[eventType](MEDIA_TYPE.IFRAME);\n\t\t}\n\t}\n\n\tprivate _html5MediaTracker(): void {\n\t\tconst that = this;\n\t\tsetInterval(function() {\n\t\t\tif (that._started) {\n\t\t\t\tthat.recordEvent(MEDIA_TYPE.VIDEO, EVENT_TYPE.TIME_WATCHED);\n\t\t\t}\n\t\t}, 3 * 1000);\n\t\tthis._mediaElement.addEventListener(\n\t\t\tHTML5_MEDIA_EVENT.PLAY,\n\t\t\t() => {\n\t\t\t\tthat.eventActionMapping[EVENT_TYPE.PLAY](MEDIA_TYPE.VIDEO);\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\tthis._mediaElement.addEventListener(\n\t\t\tHTML5_MEDIA_EVENT.PAUSE,\n\t\t\t() => {\n\t\t\t\tthat.eventActionMapping[EVENT_TYPE.PAUSE](MEDIA_TYPE.VIDEO);\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\n\t\tthis._mediaElement.addEventListener(\n\t\t\tHTML5_MEDIA_EVENT.ENDED,\n\t\t\t() => {\n\t\t\t\tthat.eventActionMapping[EVENT_TYPE.ENDED](MEDIA_TYPE.VIDEO);\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t}\n\n\tprivate playEventAction(mediaType) {\n\t\tthis._started = true;\n\t\tthis.recordEvent(mediaType, EVENT_TYPE.PLAY);\n\t}\n\n\tprivate pauseEventAction(mediaType) {\n\t\tthis._started = false;\n\t\tthis.recordEvent(mediaType, EVENT_TYPE.PAUSE);\n\t}\n\n\tprivate endedEventAction(mediaType) {\n\t\tthis._started = false;\n\t\tthis.recordEvent(mediaType, EVENT_TYPE.ENDED);\n\t}\n\n\tprivate recordEvent(mediaType: string, eventType: string): void {\n\t\tconst newParams = Object.assign({}, this._params);\n\t\tconst { eventData } = newParams;\n\t\teventData.eventType = eventType;\n\t\tif (mediaType === MEDIA_TYPE.VIDEO) {\n\t\t\teventData.properties.timestamp = this._mediaElement.currentTime;\n\t\t\teventData.properties.duration = this._mediaElement.duration;\n\t\t} else {\n\t\t\teventData.properties.timestamp = this._financial(\n\t\t\t\tthis._iframePlayer.getCurrentTime()\n\t\t\t);\n\t\t\teventData.properties.duration = this._financial(\n\t\t\t\tthis._iframePlayer.getDuration()\n\t\t\t);\n\t\t}\n\t\tconst percentage =\n\t\t\tparseFloat(eventData.properties.timestamp) /\n\t\t\tparseFloat(eventData.properties.duration);\n\t\teventData.properties.eventValue = Number(percentage.toFixed(4));\n\t\tdelete eventData.properties.domElementId;\n\t\tthis._provider.putToBuffer(newParams);\n\t}\n\n\tprivate _financial(x) {\n\t\treturn Number.parseFloat(x).toFixed(4);\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}